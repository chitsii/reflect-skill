---
description: セッションから学習を抽出して知識ファイルに記録
---

# /reflect-skill:reflect

セッションを分析し、**ユーザーによる修正**を `.reflect/knowledge/` に記録。

## 知識の定義

**知識 = ユーザーがClaudeの出力を「修正」した内容**

| 知識である | 知識ではない |
|-----------|-------------|
| 「〜に変えて」 | 「OK」「いいね」 |
| 「〜しないで」 | 「全てOKです」 |
| 「〜を使って」 | 「そのままで」 |
| 「違う、〜だ」 | 単なる質問 |
| 「毎回〜して」 | 情報の提供 |

**目的**: ユーザーによる修正が蓄積され、開発体験を潤滑化すること

## 実行手順

### Step 1: セッション分析
会話履歴をスキャンし、**ユーザーによる修正**を検出:

#### High（明示的指示）
**検出パターン:**
- 強制: 「必ず」「絶対に」「常に」「毎回」「例外なく」
- 禁止: 「〜するな」「〜しないで」「〜禁止」「〜NG」「〜やめて」
- 修正指示: 「〜に変えて」「〜を使って」「〜にして」（2回以上）
- 明示的ルール: 「ルール:」「規約:」「必須:」

**例:**
- 「Buttonは必ずshadcnから使って」→ High
- 「console.logは使わないで」→ High
- 「このプロジェクトではTypeScriptを使う」→ High

#### Medium（修正指示）
**検出パターン:**
- 好みの修正: 「〜がいい」「〜の方がいい」「〜にして」
- 軽微な修正: 「ちょっと違う」「〜も追加して」
- 1回の指摘: 同じ修正が1回のみ

**例:**
- 「Result型を使う方がいい」→ Medium（好みの修正）
- 「ここは〜にして」→ Medium（軽微な修正）

**知識ではない（除外）:**
- 「OK」「いいね」「それでいい」（単なる承認）
- 「全てOKです」（修正なしの承認）
- 「そうそう」（確認のみ）

#### Low（暗黙の修正）
**検出パターン:**
- 暗黙の好み: 明示的に言わないが、特定の選択を繰り返す
- 文脈依存の修正: 「今回は〜で」（次回は異なる可能性）

**例:**
- 複数回、特定のライブラリを選択 → Low（暗黙の好み）
- 「今回は〜で」→ Low（文脈依存）

**知識ではない（除外）:**
- Claudeの推測（ユーザーの修正がない）
- 単なる観察（修正に繋がっていない）

### Step 2: 重複・競合検出
新しい知識を追加する前に、既存知識との重複をチェック:

**チェック項目:**
1. 同一トピック: 既存の知識と同じ主題か
2. 矛盾: 既存の知識と矛盾しないか
3. 上位互換: 既存の知識を包含するか

**競合時の選択肢:**
- **マージ**: 既存知識に追記・統合
- **上書き**: 新しい知識で置換（信頼度が高い場合）
- **並記**: 両方を記載（状況依存の場合）
- **スキップ**: 追加しない

### Step 3: 更新提案
検出シグナルと競合チェック結果を元に、更新内容を提案:

```
📝 検出された学習 (3件)

[High] UI規約
  内容: Buttonはshadcnから使用
  競合: なし
  → high/main.md に追加

[Medium] エラー処理
  内容: Result型でエラーを返す
  競合: 既存「try-catchを使う」と矛盾
  → マージ/上書き/スキップ?

[Low] 命名傾向
  内容: ハンガリアン記法を避ける傾向
  競合: なし
  → low/main.md に追加
```

### Step 4: ユーザー確認
- Y: 全て適用
- 数字: 個別に確認（例: "2" で2番目を詳細表示）
- 自然言語: 修正指示
- N: キャンセル

### Step 5: 適用
1. `.reflect/knowledge/` 内のファイルを更新
2. `_index.md` を更新（medium/low）
3. `config.json` の `lastReflect` を更新
4. Git commit & push（リモートがあれば）

## 知識ファイルの場所
- `.reflect/knowledge/high/` - 常に読む
- `.reflect/knowledge/medium/` - 関連時に検索
- `.reflect/knowledge/low/` - アーカイブ

## 注意
- 設計判断は書かない（→ DESIGN.md）
- 不変のルールは書かない（→ CLAUDE.md）
- 200行以内を維持
