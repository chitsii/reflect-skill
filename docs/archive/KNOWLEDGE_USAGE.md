# 知識ファイル活用戦略

## 1. フォルダ構造

```
.claude/knowledge/
├── high/      # 常に読む（セッション開始時）
├── medium/    # 関連時に読む（検索で発見）
└── low/       # アーカイブ（明示的に参照時のみ）
```

**読み込みルール:**
- `high/`: セッション開始時に全ファイル読む
- `medium/`: 作業内容に応じて検索・読み込み
- `low/`: 明示的に求められた時のみ

---

## 2. _index.md の案

### 案A: キーワードマッピングのみ

```markdown
# Index
Button → ui-prefs.md
camelCase → naming.md
winston → logging.md
API → api-client.md, error-handling.md
```

| メリット | デメリット |
|----------|------------|
| 極めて簡潔 | ファイルの概要がわからない |
| 更新が容易 | 新規キーワード追加漏れのリスク |
| 検索特化 | ファイル一覧として不十分 |

---

### 案B: ファイル一覧＋キーワード

```markdown
# Index

## Files
| file | keywords |
|------|----------|
| ui-prefs.md | Button, shadcn, コンポーネント |
| naming.md | camelCase, 命名, 変数 |
| logging.md | winston, ログ, エラー |

## Keyword → File
Button → ui-prefs.md
camelCase → naming.md
...
```

| メリット | デメリット |
|----------|------------|
| ファイル一覧と検索の両方 | 冗長（情報の重複） |
| 俯瞰しやすい | 更新箇所が2つ |

---

### 案C: ファイル一覧のみ（キーワードなし）

```markdown
# Index

## high/
- ui-prefs.md: UIコンポーネントの好み
- naming.md: 命名規則の補足

## medium/
- logging.md: ログ出力方法
- api-client.md: API呼び出しパターン
```

| メリット | デメリット |
|----------|------------|
| シンプル | キーワード検索できない |
| 更新が容易 | Claudeがファイル選択しにくい |

---

### 案D: 不要（フォルダ構造で十分）

```
high/ → 全部読むのでindex不要
medium/ → ファイル名から判断
low/ → めったに使わない
```

| メリット | デメリット |
|----------|------------|
| 管理コストゼロ | ファイル名の命名規則が重要に |
| 自動生成不要 | medium/の検索精度が下がる |

---

### 推奨案の検討

**目的**: 特定ファイルを見つけやすくする

| 案 | high/ | medium/ | low/ | 推奨度 |
|----|-------|---------|------|--------|
| A (キーワードのみ) | 不要（全読み） | 有効 | 有効 | ○ |
| B (一覧+キーワード) | 不要 | 有効 | 有効 | △（冗長） |
| C (一覧のみ) | 不要 | △ | △ | △ |
| D (なし) | - | ファイル名依存 | ファイル名依存 | ○（シンプル） |

**結論案**:
- `high/`: indexなし（全読み）
- `medium/`, `low/`: 案A（キーワードマッピング）を各フォルダに配置

```
.claude/knowledge/
├── high/           # indexなし、全ファイル読む
│   ├── ui-prefs.md
│   └── naming.md
├── medium/
│   ├── _index.md   # キーワード→ファイル
│   ├── logging.md
│   └── api-client.md
└── low/
    ├── _index.md   # キーワード→ファイル
    └── old-patterns.md
```

---

## 3. 知識の自動活用について

### 問題
Claudeがセッション中に自動的に知識を使うには、「知識フォルダの存在」と「読み方」を知っている必要がある。

### 選択肢

#### 選択肢1: CLAUDE.mdに記載

```markdown
# CLAUDE.md

## 知識ベース
セッション開始時に `.claude/knowledge/high/` を全て読むこと。
作業中は必要に応じて `medium/` を検索すること。
```

| メリット | デメリット |
|----------|------------|
| 確実に読まれる | CLAUDE.mdが肥大化 |
| スキルなしでも動く | 更新箇所が増える |

#### 選択肢2: Reflectスキル内で完結

```markdown
# reflect.md (スキル)

## 知識参照
このスキル実行時、まず high/ を読み、
作業内容に応じて medium/ を検索する。
```

| メリット | デメリット |
|----------|------------|
| CLAUDE.mdがシンプル | スキル呼び出し時のみ有効 |
| 知識管理が一箇所 | 通常作業では知識が使われない |

#### 選択肢3: セッション開始Hookで注入

```bash
# hooks/session-start.sh
echo "知識ベース: .claude/knowledge/high/ を参照してください"
```

| メリット | デメリット |
|----------|------------|
| 自動的に通知される | Hook設定が必要 |
| CLAUDE.md変更不要 | Hookの信頼性に依存 |

#### 選択肢4: ハイブリッド（推奨）

```markdown
# CLAUDE.md（最小限）
知識ベース: `.claude/knowledge/` を活用。詳細は `/reflect-status` 参照。
```

```markdown
# reflect-status.md
- high/: セッション開始時に全読み
- medium/: 作業内容に応じて検索
- low/: 明示的要求時のみ
```

| メリット | デメリット |
|----------|------------|
| CLAUDE.mdは最小限 | 2箇所に情報が分散 |
| 詳細はスキルが管理 | |

---

## 4. 活用フロー（案）

```
┌─────────────────────────────────────────┐
│          セッション開始                  │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│  CLAUDE.md を読む                        │
│  → 「知識ベース: .claude/knowledge/」    │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│  high/ を全て読む（常に）                │
│  - ui-prefs.md                          │
│  - naming.md                            │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│         ユーザーからタスク受領           │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│  タスク分析                              │
│  → キーワード抽出（例: "Button", "API"） │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│  medium/_index.md を検索                 │
│  → Button → ui-prefs.md（既読ならスキップ）│
│  → API → api-client.md を読む           │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│         作業実行                         │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│  修正・承認があれば /reflect             │
│  → 知識を更新 → Git commit & push       │
└─────────────────────────────────────────┘
```

---

## 5. 決定事項

| 項目 | 決定 |
|------|------|
| フォルダ構造 | high / medium / low |
| _index.md | medium/, low/ にキーワードマッピング（案A） |
| CLAUDE.md | 最小限（1行） |
| 活用方法 | CLAUDE.md最小 + スキルで詳細（選択肢4） |

---

## 6. 知識ファイルのメンテナンス戦略

### 6.1 初期構造

```
.claude/knowledge/
├── high/
│   └── main.md       # 常に全読み
├── medium/
│   ├── _index.md     # 検索用（常に存在）
│   └── main.md
└── low/
    ├── _index.md     # 検索用（常に存在）
    └── main.md
```

**ルール:**
- high/: 全読みなので_index.mdは分割時のみ
- medium/, low/: _index.mdを常に配置

### 6.2 ファイル分割のタイミング

**200行超えで分割**

```
.claude/knowledge/
├── high/
│   ├── _index.md  # 分割時に追加
│   ├── ui.md
│   └── naming.md
├── medium/
│   ├── _index.md
│   └── main.md
└── low/
    ├── _index.md
    └── main.md
```

### 6.3 分割ルール

| 条件 | アクション |
|------|-----------|
| 200行以下 | 1ファイルのまま |
| 200行超え | カテゴリで分割 |
| 分割後も200行超え | さらに細分化 |

### 6.4 ファイル形式

**1ファイル時（high/main.md）:**
```markdown
# High
<!-- updated: 2024-01-20 -->

## UI
- Button: shadcn から import
- Icon: lucide-react 使用

## Naming
- camelCase 徹底
- bool: is/has 接頭辞
```

**分割後（high/_index.md）:**
```markdown
# Index
Button, shadcn → ui.md
camelCase, 命名 → naming.md
```
